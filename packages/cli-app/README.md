# App CLI

## Setup

A number of config variables are required in order to run CLI. One could either provide those in ~/.wire/config.yml in format of yaml.

## Operations

To deploy apps we need a number of steps:

- build: This generates the ditribution files along with configuration specific for the given app.yml
- publish: Upload the dist folder to IPFS. Update the hash in the app.yml
- register: Use app.yml to generate a record in WNS.

All this operations can be resumed with one command:

```
$ wire app deploy
```

### Build app.

Before you publish your app you need to build it using `wire app build`.

Your `app.yml` MUST be present and it must have `name` and `version` defined.

You can specify the following params in your `app.yml`:

- `build`: Build command. Defaults to `yarn webpack -p`.

Example:

```yml
name: 'Example App'
version: 0.0.0
build: yarn dist
```

Then run:

```bash
$ wire app build
```

### Publish to IPFS

```bash
$ wire app publish
```

### Registration

In package root folder:

- make sure `app.yml` is presented, with `name` and `version` fields. E.g.:

```yaml
name: 'Example App'
version: 0.0.1
build: yarn dist
package:
  /: <IPFS HASH ID GENERATED BY PUBLISH>
```

- register app:

> You could use optional `--name` argument in order to assign specific name to the record.

```bash
$ wire app register --name "wrn://dxos/application/example"
```

### Query

```bash
$ wire app query

[
  {
    "id": "bafyreicjftv7di4x4og7gbxnrtqsqchiqcdchxnemnfiuqet35h2jzfww4",
    "names": [
      "wrn://dxos/application/example"
    ],
    "owners": [
      "6ee3328f65c8566cd5451e49e97a767d10a8adf7"
    ],
    "bondId": "d466a4a9a640040f3d9582a5dc8797b43409c3bfde338b4b74ead9ffa225b494",
    "createTime": "2020-08-25T18:47:03.082647202",
    "expiryTime": "2021-08-25T18:47:03.082647202",
    "attributes": {
      "package": {
        "/": "QmbPxkLXcHxWcUquhSEVCP5mUNQBLezjETGLzaDWmLscba"
      },
      "type": "wrn:app",
      "version": "0.0.1",
      "build": "yarn dist",
      "name": "Example App"
    }
  },
]
```

### Serve Apps

Once apps are published to ipfs and registered to WNS we can use `wire app serve` to serve the distributed files.

```bash
wire app serve
```

- `port`: Which port to start the server. Defaults to `5999`

The following URLs will be available:

- GET `/app/dxos.org/example-app/`: Latest version on WNS by default.
- GET  `/app/dxos.org/example-app@0.0.1/`

#### Apps config endpoints:

If using `dxos/config` dynamic configuration each app can request its own config from a config endpoint (`/config/config.json`).
This endpoint will serve the a json format of a YAML file located at `~/.wire/remote.yml`. This can be modified in the global configuration file:

```yaml
cli:
  app:
    serve:
      config: '/opts/apps-config/default.yml'
```


The following URLs will be available:

- GET `/app/dxos.org/example-app/config/config.json`: To match app latest version on WNS by default.
- GET  `/app/dxos.org/example-app@0.0.1/config/config.json`
